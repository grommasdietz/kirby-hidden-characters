(function(){"use strict";function d(i){return i==null?"":String(i).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(i){if(!i)return"";const c=i.replace(/\n/g,"<br>"),o=new DOMParser().parseFromString(`<div>${c}</div>`,"text/html").body.firstChild;function r(t,a=[]){if(t.nodeType===Node.TEXT_NODE)a.push(t);else if(t.nodeType===Node.ELEMENT_NODE&&!["SCRIPT","STYLE"].includes(t.tagName)){if(t.tagName==="BR"){const n=document.createElement("break");t.parentNode.insertBefore(n,t)}Array.from(t.childNodes).forEach(n=>r(n,a))}return a}const h=r(o);for(const t of h){const a=document.createDocumentFragment();for(const n of t.nodeValue)if(n.match(/[\s\u00A0]/)){const s=document.createElement("space");s.setAttribute("data-character",n),s.textContent=n,a.appendChild(s)}else if(n==="Â­"){const s=document.createElement("shy");s.textContent=n,a.appendChild(s)}else a.appendChild(document.createTextNode(n));t.replaceWith(a)}return o.innerHTML}window.panel.plugin("grommasdietz/hidden-characters",{use:[i=>{const c=["k-writer-input","k-textarea-input","k-text-input"];i.mixin({mounted(){c.includes(this.$options.name)&&this.$nextTick(()=>{const e=this.$el.matches(".k-text-input")?this.$el:this.$el.querySelector(".ProseMirror, .k-textarea-input-native");if(!e)return;this.$overlayEl=document.createElement("div");const l=["aria-hidden","autofocus","contenteditable","id","name","placeholder","spellcheck","tabindex"];for(const r of e.attributes)l.includes(r.name)||this.$overlayEl.setAttribute(r.name,r.value);this.$overlayEl.classList.add("gd-hidden-characters"),this.$overlayEl.setAttribute("data-tag",e.tagName.toLowerCase()),this.$overlayEl.setAttribute("aria-hidden","true"),this.$overlayEl.inert=!0;const o=()=>{let r=e.matches(".ProseMirror")?e.innerHTML:this.value;e.matches(".ProseMirror")||(r=d(r||"")),this.$overlayEl.innerHTML=u(r||"")};o(),e.after(this.$overlayEl),e.matches(".ProseMirror")&&(this.$observer=new MutationObserver(o),this.$observer.observe(e,{childList:!0,subtree:!0,characterData:!0}))})},beforeDestroy(){this.$observer&&this.$observer.disconnect()},watch:{value(e){if(!c.includes(this.$options.name)||!this.$overlayEl||this.$el.querySelector(".ProseMirror"))return;const l=d(e||"");this.$overlayEl.innerHTML=u(l)}}})}]})})();
