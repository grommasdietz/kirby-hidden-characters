(function(){"use strict";function l(o){if(!o)return"";const c=o.replace(/\n/g,"<br>"),a=new DOMParser().parseFromString(`<div>${c}</div>`,"text/html").body.firstChild;function n(t,i=[]){if(t.nodeType===Node.TEXT_NODE)i.push(t);else if(t.nodeType===Node.ELEMENT_NODE&&!["SCRIPT","STYLE"].includes(t.tagName)){if(t.tagName==="BR"){const r=document.createElement("break");t.parentNode.insertBefore(r,t)}Array.from(t.childNodes).forEach(r=>n(r,i))}return i}const u=n(a);for(const t of u){const i=document.createDocumentFragment();for(const r of t.nodeValue)if(r.match(/[\s\u00A0]/)){const s=document.createElement("space");s.setAttribute("data-character",r),s.textContent=r,i.appendChild(s)}else if(r==="Â­"){const s=document.createElement("shy");s.textContent=r,i.appendChild(s)}else i.appendChild(document.createTextNode(r));t.replaceWith(i)}return a.innerHTML}window.panel.plugin("grommasdietz/hidden-characters",{use:[o=>{const c=["k-writer-input","k-textarea-input","k-text-input"];o.mixin({mounted(){c.includes(this.$options.name)&&this.$nextTick(()=>{const e=this.$el.matches(".k-text-input")?this.$el:this.$el.querySelector(".ProseMirror, .k-textarea-input-native");if(!e)return;this.$overlayEl=document.createElement("div");const d=["aria-hidden","autofocus","contenteditable","id","name","placeholder","spellcheck","tabindex"];for(const n of e.attributes)d.includes(n.name)||this.$overlayEl.setAttribute(n.name,n.value);this.$overlayEl.classList.add("gd-hidden-characters"),this.$overlayEl.setAttribute("data-tag",e.tagName.toLowerCase()),this.$overlayEl.setAttribute("aria-hidden","true"),this.$overlayEl.inert=!0;const a=()=>{const n=e.matches(".ProseMirror")?e.innerHTML:this.value;this.$overlayEl.innerHTML=l(n||"")};a(),e.after(this.$overlayEl),e.matches(".ProseMirror")&&(this.$observer=new MutationObserver(a),this.$observer.observe(e,{childList:!0,subtree:!0,characterData:!0}))})},beforeDestroy(){this.$observer&&this.$observer.disconnect()},watch:{value(e){!c.includes(this.$options.name)||!this.$overlayEl||this.$el.querySelector(".ProseMirror")||(this.$overlayEl.innerHTML=l(e||""))}}})}]})})();
